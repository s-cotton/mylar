<%inherit file="base.html"/>
<%!
        import os
        import mylar
	from mylar import db
        from mylar.helpers import checked
%>

<%def name="headerIncludes()">

  
  <!--
  <div class="row">
    <div class="col-xs-12">
      <div class="btn-group pull-right">
        %if mylar.TAB_ENABLE:
        <a id="menu_link_delete" href="#" data-success="Syncing complete." class="btn btn-success sync-to-device">
          <span class="glyphicon glyphicon-upload"></span>&nbsp;Sync
        </a>
        %endif
        <a id="menu_link_delete" href="#" data-success="All Read Records Removed" class="btn btn-warning remove-read-from-list">
          <span class="glyphicon glyphicon-trash"></span>&nbsp;Remove Read
        </a>
        <a id="menu_link_delete" href="#" class="btn btn-info force-new-check">
          <span class="glyphicon glyphicon-refresh"></span>&nbsp;Force New Check
        </a>
        <a id="menu_link_refresh" href="#" class="btn btn-warning clear-file-cache">
          <span class="glyphicon glyphicon-trash"></span>&nbsp;Clear File Cache
        </a>
      </div>
    </div>
  </div>
  -->
</%def>

<%def name="body()">
  <script type="text/javascript">
    var initialData = initialData || {};
  <%
  import simplejson as json
  %>
  % if len(issuelist) > 0 :
    <% json_output = json.dumps( [dict(ix) for ix in issuelist] ) %>
    initialData.issues = ${json_output}
  % endif
  </script>

  <div class="container-fluid comicdetails">
    <div class="row">
        <div class="col-xs-12">
            <h1><span class="glyphicon glyphicon-book"></span>&nbsp;&nbsp;Reading List Management</h1>
        </div>
    </div>
    
    <div class="row">
      <div class="comic-pager col-xs-12"></div>
      <div class="grid-browser col-xs-12"></div>
      <div class="table-browser col-xs-12"></div>
      <div class="cover-browser col-xs-12"></div>
      <div class="comic-pager col-xs-12"></div>
    </div>
  </div>

  <hr />

  <div class="row">
    <div class="col-xs-12">
      <h1>
        <span class="glyphicon glyphicon-book"></span>&nbsp;&nbsp;Reading List Management
      </h1>
    </div>
  </div>
  <div class="row">
    <div class="col-xs-12">
      <div class="tabs-container">
        <ul class="nav nav-tabs" role="tablist">
          <li role="presentation" class="active"><a href="#general" aria-controls="general" role="tab" data-toggle="tab">General</a></li>
          <li role="presentation"><a href="#options" aria-controls="options" role="tab" data-toggle="tab">Reading List Options</a></li>

        </ul>
        <div class="tab-content">
          <div role="tabpanel" class="tab-pane active" id="general">
            <div class="row">
              <div class="col-xs-12 col-sm-6">
                <h3>Individual Reading Lists</h3>
                <p>Your watchlisted series' that you have issues marked as wanting to add to the Reading List go here.</p>
              </div>
              <div class="col-xs-12 col-sm-6">
                <h3>Reading List Statistics <small><a tabindex="0" role="button" data-container="body" data-toggle="popover" data-placement="bottom" data-trigger="focus" title="Status Definitions" data-content="<p><strong>Added:</strong> Issue has been added to your RL.</br><strong>Downloaded:</strong> Issue has been downloaded to your device.</br><strong>Read:</strong> Issue has been marked as Read.</p>" data-html="true"><span class="glyphicon glyphicon-info-sign"></span></a></small></h3>
                <dl class="dl-horizontal">
                  <dt># of Issues Added</dt>
                  <dd>${counts['added']}</dd>
                  <dt># of Issues Sent to device</dt>
                  <dd>${counts['sent']}</dd>
                  <dt># of Issues Read</dt>
                  <dd>${counts['read']}</dd>
                  <dt>Total in Readlist Management</dt>
                  <dd>${counts['total']}</dd>
                </dl>
              </div>
            </div>
          </div>
          <div role="tabpanel" class="tab-pane" id="options">
            <form action="readlistOptions" id="chkoptions" method="GET">
              <div class="row">
                <div class="col-xs-12 col-sm-6">
                  <h3>ReadList Options</h3>
                  <div class="checkbox">
                    <label for="send2read">
                      <input type="checkbox" name="send2read" id="send2read" value="1" ${checked(mylar.SEND2READ)} />Automatically send new pulls to Readlist (Added)
                    </label>
                  </div>
                  <input type="submit" value="Update" class="btn btn-default" />
                </div>
                <div class="col-xs-12 col-sm-6">
                  <h3>Tablet Device</h3>
                  <p><em>Requires SFTP Server running on tablet (Install: <a href="https://play.google.com/store/apps/details?id=com.icecoldapps.httpsftpsserver">HTTPS / FTPS / SFTP Server</a>)</em></p>
                  <div class="checkbox">
                    <label for="tab_enable">
                      <input id="tabenable" type="checkbox" onclick="initConfigCheckbox($this);" name="tab_enable" id="tab_enable" value="1" ${checked(mylar.TAB_ENABLE)} />
                      Enable Tablet (Android)
                    </label>
                  </div>
                  <div class="form-group">
                    <label for="tab_host">Host (IP:Port)</label>
                    <input type="text" placeholder="IP Address of tablet" name="tab_host" id="tab_host" value="${mylar.TAB_HOST}" class="form-control" />
                  </div>
                  <div class="form-group">
                    <label for="tab_user">Username</label>
                    <input type="text" name="tab_user" id="tab_user" value="${mylar.TAB_USER}" class="form-control" />
                  </div>
                  <div class="form-group">
                    <label for="tab_pass">Password</label>
                    <input type="password" name="tab_pass" id="tab_pass" value="${mylar.TAB_PASS}" class="form-control" />
                  </div>
                  <div class="form-group">
                    <label for="tab_directory">Path on Tablet</label>
                    <input type="text" placeholder="Full path (or jailed path)" name="tab_directory" id="tab_directory" value="${mylar.TAB_DIRECTORY}" class="form-control" />
                  </div>
                  <div class="checkbox">
                    <label for="maintainseriesfolder">
                      <input type="checkbox" name="maintainseriesfolder" id="maintainseriesfolder" value="1" ${checked(mylar.MAINTAINSERIESFOLDER)} />
                      Maintain Comic Folder Structure when Syncing to Tablet
                    </label>
                  </div>
                  <div class="checkbox">
                    <label for="removereadfromdevice">
                      <input type="checkbox" name="removereadfromdevice" id="removereadfromdevice" value="1" ${checked(mylar.SEND2READ)} />Remove Read Issues from Tablet during Sync
                    </label>
                  </div>
                  <input type="submit" value="Update" class="btn btn-default" />
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>

  <form action="markreads" method="get" id="markreads">
    <div class="row">
      <div class="col-xs-12">
        <div class="btn-group" role="group">
          <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Mark Selected Issues
            <span class="caret"></span>
          </button>
          <!-- <select name="action" onChange="" data-error="You didn't select any issues" data-success="selected issues marked">
                                <option disabled="disabled" selected="selected">Choose...</option>
                                <option value="Added">Added</option>
                                <option value="Downloaded">Downloaded</option>
                                <option value="Read">Read</option>
                                <option value="Remove">Remove</option>
                                <option value="Send">Send</option>
                </select> -->
          <ul class="dropdown-menu mark-all-as">
            <li><a href="#">Added</a></li>
            <li><a href="#">Downloaded</a></li>
            <li><a href="#">Read</a></li>
            <li><a href="#">Remove</a></li>
            <li><a href="#">Send</a></li>
          </ul>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-xs-12">
        <table class="table table-striped table-bordered table-sorted" id="bsIssuesTable">
          <thead>
            <tr>
              <th id="select"><input type="checkbox" onClick="toggle(this)" /></th>
              <th id="comicname">ComicName</th>
              <th id="issue">Issue</th>
              <th id="issueyear">Pub Date</th>
              <th id="status">Status</th>
              <th id="statuschange">Change</th>
              <th class="filter-false" id="options">Options</th>
            </tr>
          </thead>
          <tbody>
            %for issue in issuelist:
            <%
              if issue['Status'] == 'Read':
                grade = 'A'
                comic_context = 'info'
              elif issue['Status'] == 'Added':
                grade = 'X'
                comic_context = 'active'
              elif issue['Status'] == 'Downloaded':
                grade = 'C'
                comic_context = 'success'
              else:
                grade = 'Z'
                comic_context = 'active'

            %>
                  <tr class="grade${grade} ${comic_context}" data-issueid="${issue['IssueID']}" data-comicname="${issue['ComicName']}" data-issuenumber="${issue['Issue_Number']}" >
                    <td id="select">
                      <input type="checkbox" name="${issue['IssueID']}" value="${issue['IssueID']}" class="checkbox" />
                    </td>
                    <td id="comicname">
                      <a href="comicDetails?ComicID=${issue['ComicID']}">
                        ${issue['ComicName']} (${issue['SeriesYear']})
                      </a>
                    </td>
                    <td id="issue">
                      ${issue['Issue_Number']}
                    </td>
                    <td id="issueyear">
                      ${issue['IssueDate']}
                    </td>
                    <td id="status">
                      ${issue['Status']}
                    </td>
                    <td id="statuschange">
                      ${issue['StatusChange']}
                    </td>
                    <td id="options">
                      <div class="btn-group">
                        <a class="btn btn-default btn-sm remove-from-read-list">
                          <span class="glyphicon glyphicon-remove" title="Remove from Reading List"></span>
                        </a>
                        <a data-success="Marked ${issue['ComicName']} ${issue['Issue_Number']} as Read." class="btn btn-default btn-sm mark-as-read">
                          <span class="glyphicon glyphicon-eye-open" title="Mark as Read"></span>
                        </a>
                        
                        %if issue['Location'] is not None:
                        <a href="downloadthis?pathfile=${issue['Location'] |u}" class="btn btn-default btn-sm">
                          <span class="glyphicon glyphicon-download" title="Download the Issue"></span>
                        </a>
                        %endif
                      </div>
                        
                    </td>
                  </tr>
            %endfor
          </tbody>
          <tfoot>
          <tr>
            <th colspan="7" class="ts-pager form-horizontal">
              <button type="button" class="btn first"><i class="icon-step-backward glyphicon glyphicon-step-backward"></i></button>
              <button type="button" class="btn prev"><i class="icon-arrow-left glyphicon glyphicon-backward"></i></button>
              <span class="pagedisplay"></span> <!-- this can be any element, including an input -->
              <button type="button" class="btn next"><i class="icon-arrow-right glyphicon glyphicon-forward"></i></button>
              <button type="button" class="btn last"><i class="icon-step-forward glyphicon glyphicon-step-forward"></i></button>
              <select class="pagesize input-mini" title="Select page size">
                <option selected="selected" value="10">10</option>
                <option value="20">20</option>
                <option value="30">30</option>
                <option value="40">40</option>
              </select>
              <select class="pagenum input-mini" title="Select page number"></select>
            </th>
          </tr>
        </tfoot>
        </table>
      </div>
    </div>
</%def>

<%def name="headIncludes()">
	
</%def>

<%def name="javascriptIncludes()">
  <script type="text/javascript" src="interfaces/bootstrap/js/views/readlist.js"></script>
  <script type="text/javascript" src="interfaces/bootstrap/js/views/readinglist.js"></script>
</%def>
